<!-- ####################################################################################### -->
<!-- This page contains the medication specification: more information, intake -->
<!-- ####################################################################################### -->
<template>
    <div class="page" data-name="about">
        <!-- --------------------------- Navigation Bar --------------------------------- -->
        <!-- Contains: Back button and page title ("New Medication") -->
        <div class="navbar">
            <div class="navbar-inner sliding">
                <div class="left">
                    <a href="#" class="link back">
                        <i class="icon icon-back"></i>
                        <span class="ios-only">Back</span>
                    </a>
                </div>
                <div class="title">New Medication</div>
            </div>
        </div>

        <!-- ############################# Scrollable page content ########################## -->
        <div class="page-content" id="page-reminder-content">
            <!-- ----------------------- Medic. image and name on top ------------------------- -->
            <div id="med_info">
                <!-- image -->
                <div id="image-container">
                    <!-- image will be added dynamically in code below-->
                </div>
                <!-- name and link to "more information" -->
                <div id="med_name">
                    <h2>
                        <!-- title will be added dynamically in code below-->
                    </h2>
                    <a href="(.*)" class="item-content item-link">
                        more information
                    </a>
                </div>
            </div>


            <!-- ---------------------------- Set intake  ------------------------------ -->
            <div id="set-reminder">
                <h3>Reminder Settings</h3>
                <p>These values are taken from the package insert. Please customize them according to your doctors
                    recommendations and your personal preferences </p>
                <div class="toolbar tabbar">
                    <div class="toolbar-inner">
                        <a href="#tab-1" class="tab-link tab-link-active">daily</a>
                        <a href="#tab-2" class="tab-link">weekly</a>
                        <a href="#tab-3" class="tab-link">monthly</a>
                    </div>
                </div>
                <!-- TO BE DONE HERE: Specify "weekly" and "monthly" -->
                <div class="tabs">
                    <!-- -------------------- DAILY --------------------- -->
                    <div id="tab-1" class="tab tab-active list">
                        <ul>
                            <li class="swipeout"> <!-- to make it deletable by swiping -->
                                <div class="swipeout-content item-content">
                                    <div class="flex-grid">
                                        <!--  -------- set time -------- -->
                                        <div class="col1">
                                            <div class="list no-margin" id="timer">
                                                <ul>
                                                    <li>
                                                        <div class="item-content item-input">
                                                            <div class="item-inner">
                                                                <div class="item-title item-label">Time</div>
                                                                <div class="item-input-wrap">
                                                                    <input type="text" placeholder="Time"
                                                                           readonly="readonly"
                                                                           id="demo-picker-date"/>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </li>
                                                </ul>
                                            </div>
                                            <div class="block block-strong no-padding no-margin margin-bottom"
                                                 id="zeroHeight">
                                                <div id="demo-picker-date-container"></div>
                                            </div>
                                        </div>
                                        <!--  -------- set amount -------- -->
                                        <div class="col2">
                                            <small>Amount</small>
                                            <div class="stepper stepper-small stepper-round stepper-fill stepper-init"
                                                 id="amount">
                                                <div class="stepper-button-minus" id="minus"></div>
                                                <div class="stepper-input-wrap" id="border_stepper">
                                                    <input type="text" value="1" min="0" max="9" step="1" readonly>
                                                </div>
                                                <div class="stepper-button-plus" id="plus"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--  -------- Specify what happens when we swipe it to the left (=delete) -------- -->
                                <div class="swipeout-actions-right">
                                    <!-- We add data-confirm and data-confirm-title attributes -->
                                    <a href="#" class="swipeout-delete"
                                       data-confirm="Are you sure want to delete this intake?"
                                       data-confirm-title="Delete?">Delete</a>
                                </div>
                            </li>
                        </ul>
                    </div>



                    <!-- -------------------- WEEKLY --------------------- -->
                    <div id="tab-2" class="page-content tab">
                        <div class="block">
                            <p>weekly</p>
                            ...
                        </div>
                    </div>

                    <!-- -------------------- MONTHLY --------------------- -->
                    <div id="tab-3" class="page-content tab">
                        <div class="block">
                            <p>monthly</p>
                            ...
                        </div>
                    </div>
                </div>
            </div>


            <div class="fab fab-extended fab-center-bottom" @click="addIntake">
                <a href="#" class="open-alert">
                    <i class="icon f7-icons ios-only">add</i>
                    <i class="icon material-icons md-only">add</i>
                    <div class="fab-text">Add intake</div>
                </a>
            </div>
            <a class="col button button-big button-raised button-fill link" @click="addMedicationToIndex"
               id="add_button" href="/">Finish</a>
        </div>
    </div>
</template>


<!-- ADD CODE HERE -->
<script>
    return {
        methods: {
            /**
             * Adds a new intake
             */
            addIntake: function () {
                // TO BE DONE HERE: Add a new intake
                console.log("Should add intake");

            },
            /**
             * Adds the current medication to our medication array: it will be displayed in the cabinet
             */
            addMedicationToIndex: function () {
                var self = this;
                var app = self.$app;
                app.data.medicationList.push(ciprofloxacin);
            }
        },
        on: {
            pageMounted: function () {
                //Medication information
                //TO BE DONE HERE: currently it always adds ciprofloxacin. If we have time we could arrange that it adds the medication that was entered
                //image
                var img = $$('<img class="medi_image" alt="Medicament"/>');
                var my_src = ciprofloxacin.img; //from database meds.js
                img.attr("src",my_src);
                $$('#image-container').append(img);
                //title
                $$('#med_name h2').text(ciprofloxacin.name); //from database meds.js

                // Click on add intake
                // TO BE DONE HERE: Replace this content so that we can actually add a medication
                $$('.open-alert').on('click', function () {
                    app.dialog.alert('Currently not working.', 'Remindy');
                });

                //Amount: schreibe Eingabe "Pillen pro Tag" in entsprechendes Objekt unter per_day
                //Problem aktuell noch: wir koennen nur Ciprofloxacin hinzufuegen, denn wir haben nur hierfuer einen Eintrag in meds.js. Was machen wir mit anderen Medikamenten? An sich sollte es dynamisch gehen, in diesem Fall muss man aber alle Information zu einem Medikament (siehe meds.js) irgendwie aus dem Internet ziehen
                var stepper = app.stepper.create({
                    el: '.stepper',
                    on: {
                        change: function () {
                            ciprofloxacin.per_day = stepper.getValue();
                        }
                    }
                });

                // TO DO HERE:Change intake ampunt and time
                //Wichtig dabei: über Ciprofloxacin.intakte.push
                // Das Datum Dabei immer: new Date(2019, 1, 9, XX, YY, 0, 0) - XX und YY mit Stunden und Minuten fuellen
                var today = new Date();
                var pickerInline = app.picker.create({
                    // containerEl: '#demo-picker-date-container',
                    inputEl: '#demo-picker-date',
                    toolbar: true,
                    rotateEffect: true,
                    closeByOutsideClick: true,
                    toolbarCloseText: 'Set time',
                    openIn: 'popover',
                    value: [
                        today.getHours(),
                        today.getMinutes() < 10 ? '0' + today.getMinutes() : today.getMinutes()
                    ],
                    formatValue: function (values, displayValues) {
                        return values[0] + ':' + values[1];
                    },
                    cols: [
                        // Hours
                        {
                            values: (function () {
                                var arr = [];
                                for (var i = 0; i <= 23; i++) {
                                    arr.push(i);
                                }
                                return arr;
                            })(),
                        },
                        // Divider
                        {
                            divider: true,
                            content: ':'
                        },
                        // Minutes
                        {
                            values: (function () {
                                var arr = [];
                                for (var i = 0; i <= 59; i++) {
                                    arr.push(i < 10 ? '0' + i : i);
                                }
                                return arr;
                            })(),
                        }
                    ],
                    on: {
                        change: function (picker, values) {
                            var daysInMonth = new Date(picker.value[2], picker.value[0] * 1 + 1, 0).getDate();
                            if (values[1] > daysInMonth) {
                                picker.cols[1].setValue(daysInMonth);
                            }
                        },
                    }
                });
            }
        }
    }
</script>

